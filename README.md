## ëª©ì°¨
+ [í”„ë¡œì íŠ¸ ì†Œê°œ](#í”„ë¡œì íŠ¸-ì†Œê°œ)
+ [í”„ë¡œì íŠ¸ ê¸°ê°„](#í”„ë¡œì íŠ¸-ê¸°ê°„)
+ [ê°œë°œ ë„êµ¬ ë° í™˜ê²½](#ê°œë°œ-ë„êµ¬-ë°-í™˜ê²½)
+ [Use Case Diagram](#use-case-diagram)
+ [ERD](#erd)
+ [API ëª…ì„¸ì„œ](#api-ëª…ì„¸ì„œ)
+ [í…Œì´ë¸” ìƒì„±](#í…Œì´ë¸”-ìƒì„±)
+ [íŒ¨í‚¤ì§€ êµ¬ì¡°](#íŒ¨í‚¤ì§€-êµ¬ì¡°)
+ [ê²°ê³¼ í™”ë©´](#ê²°ê³¼-í™”ë©´)
+ [ì½”ë“œ ì„¤ëª…](#ì½”ë“œ-ì„¤ëª…)
+ [ê°œì„  ê³¼ì œ](#ê°œì„ -ê³¼ì œ)

## í”„ë¡œì íŠ¸ ì†Œê°œ
Todo ê´€ë¦¬ì™€ ëŒ“ê¸€ë¡œ ì†Œí†µí•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤

## í”„ë¡œì íŠ¸ ê¸°ê°„
2024.05.10 ~ (ì§„í–‰ì¤‘)

## ê°œë°œ ë„êµ¬ ë° í™˜ê²½
<img src="https://img.shields.io/badge/kotlin-%237F52FF.svg?style=for-the-badge&logo=kotlin&logoColor=white"/> <img src="https://img.shields.io/badge/jdk17-%23ED8B00.svg?style=for-the-badge&logo=openjdk&logoColor=white"/> <img src="https://img.shields.io/badge/springboot3-6DB33F?style=for-the-badge&logo=springboot&logoColor=white"> <img src="https://camo.githubusercontent.com/3c0e585bf7fbcca3f142c9c5de6bf415189bfebf5ebe71f59d2efd6272fd8d10/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f537072696e672044617461204a70612d3644423333463f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465"> 
<img src="https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white"> <img src="https://img.shields.io/badge/IntelliJIDEA-000000.svg?style=for-the-badge&logo=intellij-idea&logoColor=white"/> <img src="https://img.shields.io/badge/git-%23F05033.svg?style=for-the-badge&logo=git&logoColor=white"/> <img src="https://img.shields.io/badge/-Swagger-%23Clojure?style=for-the-badge&logo=swagger&logoColor=white">

---
<details>
    <summary>STEP 1 : Use Case Diagram, ERD, API ëª…ì„¸ì„œ</summary><div>

<b>Use Case Diagram</b>  
![USECASEDIAGRAM](https://github.com/hellou8363/todolist/assets/89592727/f4cbf471-fc3f-43b6-8167-4c3cf8e27b04)

<b>ERD</b>  
![step1-erd](https://github.com/hellou8363/todolist/assets/89592727/2734bbae-1764-4ceb-b484-9a8044a3d352)

<b>API ëª…ì„¸ì„œ</b>  
![step1-api](https://github.com/hellou8363/todolist/assets/89592727/9f11a462-669d-4446-8e09-055474dce70f)

</div></details>
<details>
    <summary>STEP 2 : Use Case Diagram, ERD, API ëª…ì„¸ì„œ</summary><div>

<b>Use Case Diagram</b>  
![step2-usecasediagram](https://github.com/hellou8363/todolist/assets/89592727/9cbee50e-f1b3-4beb-a84f-2f8a08b63b18)

<b>ERD</b>  
![step2-erd](https://github.com/hellou8363/todolist/assets/89592727/5151142b-0aab-412a-86f9-575ab9735a83)

<b>API ëª…ì„¸ì„œ</b>  
![step2-api](https://github.com/hellou8363/todolist/assets/89592727/ed4c86c6-aa35-49b9-bbb5-09d3867c32b4)

</div></details>
<details>
    <summary>STEP 3 : Use Case Diagram, ERD, API ëª…ì„¸ì„œ</summary><div>

<b>Use Case Diagram</b>  
![step3-api](https://github.com/hellou8363/todolist/assets/89592727/bb65c070-cdef-435a-bd8e-3299f9b6b764)

<b>ERD</b>  
![step2-erd](https://github.com/hellou8363/todolist/assets/89592727/5151142b-0aab-412a-86f9-575ab9735a83)

<b>API ëª…ì„¸ì„œ</b>  
![step3-api](https://github.com/hellou8363/todolist/assets/89592727/85e6c0e6-7fe9-492c-955d-56382ac3040c)

</div></details>

## Use Case Diagram
![step4-usecasediagram](https://github.com/hellou8363/todolist/assets/89592727/5f87dd2e-5123-4e0d-aee7-cf1b13700e2c)

## ERD
![step4-erd](https://github.com/hellou8363/todolist/assets/89592727/4be336be-b224-4b8f-8b1b-f37568c9f8e6)

## API ëª…ì„¸ì„œ
![api-4](https://github.com/hellou8363/todolist/assets/89592727/6d5d7680-9363-4df9-bcac-43b6c3997f82)

## í…Œì´ë¸” ìƒì„±
``` 
CREATE TABLE todo (
    id BIGSERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    writer TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed TEXT NOT NULL,
    user_id BIGINT NOT NULL,
    is_deleted BOOLEAN NOT NULL
);

CREATE TABLE comment (
    id BIGSERIAL PRIMARY KEY,
    content TEXT NOT NULL,
    writer TEXT NOT NULL,
    password TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    todo_id BIGINT,
    user_id BIGINT,
    constraint fk_comment_todo FOREIGN KEY (todo_id) REFERENCES todo ON DELETE CASCADE
);

CREATE TABLE todo_user (
    id BIGSERIAL PRIMARY KEY,
    email TEXT NOT NULL UNIQUE,
    nickname TEXT NOT NULL,
    password TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    join_type TEXT NOT NULL
);
```
## íŒ¨í‚¤ì§€ êµ¬ì¡°
```
org.zerock.todolist
â””â”€â”€ config
    â””â”€â”€ auth
      â””â”€â”€ filter
      â””â”€â”€ handler
      â””â”€â”€ util
â””â”€â”€ domain
    â”œâ”€â”€ comment
    |   â”œâ”€â”€ controller
    |   â”œâ”€â”€ dto
    |   â”œâ”€â”€ model
    |   â”œâ”€â”€ repository
    |   â””â”€â”€ service
    â”œâ”€â”€ exception
    |   â””â”€â”€ dto
    â”œâ”€â”€ todo
    |   â”œâ”€â”€ controller
    |   â”œâ”€â”€ dto
    |   â”œâ”€â”€ model
    |   â”œâ”€â”€ repository
    |   â””â”€â”€ service
    â”œâ”€â”€ user
    |   â”œâ”€â”€ controller
    |   â”œâ”€â”€ dto
    |   â”œâ”€â”€ model
    |   â”œâ”€â”€ repository
    |   â””â”€â”€ service
â””â”€â”€ infra
    â”œâ”€â”€ querydsl
    â””â”€â”€ swagger
```

## ê²°ê³¼ í™”ë©´
<details>
    <summary><b>íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ í™”ë©´</b></summary>
    <img src="https://github.com/hellou8363/todolist/assets/89592727/7c01d0a5-93f4-4101-a943-1419019fdea3">
</details>

## ì½”ë“œ ì„¤ëª…
<details>
    <summary><b>ì†Œì…œ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ êµ¬í˜„</b></summary>
    <div markdown="1">
Clientë¡œë¶€í„° Kakaoì˜ AccessTokenì„ ì „ë‹¬ ë°›ëŠ”ë‹¤.  

```kotlin
@GetMapping("/signin/kakao")
fun signinKakao(@RequestParam accessToken: String, response: HttpServletResponse) { 
    userService.signWithKakao(accessToken, response)
}
```

Serviceì—ì„œ ì§„í–‰ë˜ëŠ” ë¡œì§ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
1. AccessTokenìœ¼ë¡œ ì¹´ì¹´ì˜¤ì—ì„œ íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
2. Databaseì— ì¹´ì¹´ì˜¤ íšŒì› ì •ë³´ì˜ ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ëŠ” ì´ë©”ì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.  
    2-1. ì¼ì¹˜í•˜ëŠ” ì´ë©”ì¼ì´ ìˆë‹¤ë©´ ì˜ˆì™¸ ë°œìƒ ì—†ì´ userInfo ë³€ìˆ˜ì— í•´ë‹¹ íšŒì›ì˜ ì •ë³´ê°€ ë‹´ê¸´ë‹¤.  
    2-2. ì¼ì¹˜í•˜ëŠ” ì´ë©”ì¼ì´ ì—†ë‹¤ë©´ EmptyResultDataAccessException ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©° 5ë²ˆì„ ìˆ˜í–‰í•œë‹¤.
3. ê°€ì ¸ì˜¨ íšŒì› ì •ë³´ì˜ ì´ë©”ì¼ì´ ì´ë¯¸ ì¹´ì¹´ì˜¤ë¡œ ê°€ì…ëœ íšŒì›ì¸ì§€ í™•ì¸í•œë‹¤.  
    3-1. ì´ë¯¸ ì¹´ì¹´ì˜¤ë¡œ ê°€ì…ëœ íšŒì›ì´ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.  
    3-2. ì¹´ì¹´ì˜¤ë¡œ ê°€ì…ëœ íšŒì›ì´ ì•„ë‹ˆë¼ë©´ ì¼ë°˜íšŒì›(default)ìœ¼ë¡œ ê°€ì…ëœ íšŒì›ì´ë¯€ë¡œ ê°€ì…ì¢…ë¥˜ì— "KAKAO"ë¥¼ ì¶”ê°€í•œ í›„ ë¡œê·¸ì¸ ì²˜ë¦¬í•œë‹¤.  
4. EmptyResultDataAccessException ì˜ˆì™¸ê°€ ë°œìƒí–ˆë‹¤ëŠ” ê²ƒì€ DBì— ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ëŠ” íšŒì› ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸ìœ¼ë¡œ ì‹ ê·œê°€ì… ì²˜ë¦¬í•œë‹¤.  
    4-1. ì‹ ê·œíšŒì›ìœ¼ë¡œ ë“±í•œë‹¤.  
    4-2. ì‹ ê·œíšŒì›ìœ¼ë¡œ ë“±ë¡ëœ ì •ë³´ë¡œ ë¡œê·¸ì¸ ì²˜ë¦¬í•œë‹¤.

```kotlin
@Transactional
override fun signWithKakao(accessToken: String, response: HttpServletResponse) {

    // 1. ì¹´ì¹´ì˜¤ì—ì„œ íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜´
    val kakaoUserInfo = getUserFromKakao(accessToken)

    try {
        // 2. DBì— ê°€ì ¸ì˜¨ íšŒì› ì •ë³´ì˜ ì´ë©”ì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        val userInfo = userRepository.findByEmail(kakaoUserInfo["email"] as String)

         // 3. ì´ë¯¸ ì¹´ì¹´ì˜¤ë¡œ ê°€ì…ëœ íšŒì›ì¸ì§€ í™•ì¸
        if (userInfo.joinType.contains("KAKAO")) {

            // 3-1. ë¡œê·¸ì¸ ì²˜ë¦¬
            return signinUser(
                SigninRequest(
                    kakaoUserInfo["email"] as String,
                    "null"
                ),
                response
            )
        }

        // 3-2. ê°€ì…ì¢…ë¥˜ì— KAKAO ì¶”ê°€ í›„ ë¡œê·¸ì¸ ì²˜ë¦¬
        // 2ë²ˆì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ê²ƒì€ íšŒì› ì •ë³´ê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸
        // íšŒì›ê°€ì…ì˜ ê¸°ë³¸ jointypeì€ "EMAIL"
        userInfo.joinType = "${userInfo.joinType}, KAKAO"

        return signinUser(
            SigninRequest(
                kakaoUserInfo["email"] as String,
                   "null"
            ),
            response
        )

    // 4. EmptyResultDataAccessException ì˜ˆì™¸ê°€ ë°œìƒí–ˆë‹¤ëŠ” ê²ƒì€
    // DBì— ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ëŠ” íšŒì› ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸
    } catch (e: EmptyResultDataAccessException) { 

        // 4-1. ì‹ ê·œíšŒì›ìœ¼ë¡œ ë“±ë¡
        createUser(
            CreateUserRequest(
                kakaoUserInfo["email"].toString(),
                kakaoUserInfo["nickname"].toString(),
                "null"
            ),
            joinType = "KAKAO"
        )

        // 4-2. ì‹ ê·œíšŒì›ìœ¼ë¡œ ë“±ë¡ëœ ì •ë³´ë¡œ ë¡œê·¸ì¸ ì²˜ë¦¬
        return signinUser(
            SigninRequest(
                kakaoUserInfo["email"] as String,
                 "null"
            ),
           response
        )
    }
}
```

</div></details>
<details>
    <summary><b>ì†Œì…œ ë¡œê·¸ì¸ íšŒì› ê°€ì… ì²˜ë¦¬ ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ "null"ë¡œ ì„¤ì •í•¨ìœ¼ë¡œ ì¸í•´ ì¼ë°˜ ê°€ì…ì„ í•˜ì§€ ì•Šì€ íšŒì›ì´ ì†Œì…œ ì´ë©”ì¼ë¡œ ì¼ë°˜ ë¡œê·¸ì¸ì„ ì‹œë„í•  ìˆ˜ ìˆì§€ ì•Šì€ê°€?</b></summary><div>
í•´ë‹¹ ë¶€ë¶„ì€ UserDetailsService êµ¬í˜„ í´ë˜ìŠ¤ì˜ loadUserByUsernameì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„ ê°€ì…ì¢…ë¥˜(jointype)ì— ê¸°ë³¸ ê°€ì… ì¢…ë¥˜ì¸ "EMAIL"ì´ ì—†ë‹¤ë©´ 401 Unauthorizedì´ ë°œìƒë˜ë„ë¡ ì²˜ë¦¬í–ˆë‹¤.

```kotlin
class UserDetailServiceImpl(
    private val userRepository: UserRepository
) : UserDetailsService {

    override fun loadUserByUsername(email: String): UserDetails {
        var user: User

        try {
            user = userRepository.findByEmail(email)

            if(!user.joinType.contains("EMAIL")) {
                throw UsernameNotFoundException(email)
            }

        } catch (e: InternalAuthenticationServiceException) {
            throw UsernameNotFoundException(email)
        }

        return CustomUserDetails(user)
    }
}
```

</div></details>
<details>
    <summary><b>ë¡œê·¸ì•„ì›ƒ êµ¬í˜„</b></summary><div>
Clientë¡œë¶€í„° ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬í•  useIdë¥¼ ì „ë‹¬ ë°›ëŠ”ë‹¤.

```kotlin
@GetMapping("/logout")
fun logout(@RequestHeader(name = "userId") userId: String, response: HttpServletResponse) {
    userService.logoutUser(userId, response)
}
```
Serviceì—ì„œ Cookieë¡œ ë³´ë‚¸ RefreshTokenì„ ì‚­ì œí•˜ëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
```kotlin
override fun logoutUser(userId: String, response: HttpServletResponse) {
    jwtUtil.deleteTokenToCookie(userId, response)
}
```
DBì— ì €ì¥ëœ RefreshTokenì„ ì‚­ì œí•˜ê³  ë¸Œë¼ìš°ì €ì— ì €ì¥í•œ Cookieì˜ ë§Œë£Œ ì‹œê°„ì„ 0ìœ¼ë¡œ ì„¤ì •í•´ ì‚­ì œ ë˜ë„ë¡ ì‘ë‹µì„ ë³´ë‚¸ë‹¤.
``` kotlin
fun deleteTokenToCookie(userId: String, response: HttpServletResponse) {

    // DBì— ì €ì¥ëœ RefreshToken ì‚­ì œ
    redisService.delete(userId)

    // ë¸Œë¼ìš°ì €ì— ì €ì¥í•œ RefreshToken ì‚­ì œ
    val refreshTokenCookie = Cookie("TODOLIST_REFRESHTOKEN", null)
    refreshTokenCookie.path = "/" // ëª¨ë“  ê²½ë¡œì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
    refreshTokenCookie.maxAge = 0 // ìœ íš¨ê¸°ê°„(ì´ˆ)
    refreshTokenCookie.secure = true // HTTPSë¥¼ í†µí•´ ì „ì†¡ë˜ëŠ” ê²½ìš° ì¿ í‚¤ ì „ì†¡
    refreshTokenCookie.isHttpOnly = true // ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ ì ‘ê·¼ X

    response.status = HttpStatus.NO_CONTENT. value()
    response.contentType = MediaType.APPLICATION_JSON_VALUE

    response.addCookie(refreshTokenCookie) // ì‘ë‹µ í—¤ë”ì— Cookieë¥¼ í¬í•¨
}
```
</div></details>

## ê°œì„  ê³¼ì œ
### ê¸°ì¡´ì— ì ìš©ë˜ì–´ ìˆë˜ ë¶€ë¶„
- Controller Adviceë¡œ ì˜ˆì™¸ ê³µí†µí™” ì²˜ë¦¬
- Service ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì¶”ìƒí™”
- CustomException ì •ì˜
### ìƒˆë¡œ ë°˜ì˜ëœ ë¶€ë¶„
<details>
    <summary><b>Spring AOP ì ìš©</b></summary><div><br/>

```
@Aspect
@Component
class StopWatchAspect {
    private val logger = LoggerFactory.getLogger("Execution Time Logger")

    // domain ì „ì²´ì— ì ìš©ë˜ë©° ìˆ˜í–‰ì‹œê°„ì„ ë¡œê¹…
    @Around("execution(* org.zerock.todolist.domain..*(..))")
    fun run(joinPoint: ProceedingJoinPoint): Any? {
        val stopWatch = StopWatch()

        stopWatch.start() // ì‹œê°„ ì²´í¬ ì‹œì‘
        // ë©”ì„œë“œ ì‹¤í–‰(ì˜ˆ: Serviceì˜ getTodoById())
        val result = joinPoint.proceed() 
        stopWatch.stop() // ì‹œê°„ ì²´í¬ ì¢…ë£Œ

        // í˜¸ì¶œëœ ë©”ì„œë“œì— ëŒ€í•œ ì •ë³´
        val className =
            joinPoint.signature.declaringTypeName // íŒ¨í‚¤ì§€ëª….í´ë˜ìŠ¤ëª…
        val methodName = joinPoint.signature.name // ë©”ì„œë“œëª…
        val methodArguments = joinPoint.args // ë©”ì„œë“œì— ì‚¬ìš©ë˜ëŠ” íŒŒë¼ë¯¸í„°

        // ì¸¡ì •ëœ ìˆ˜í–‰ ì‹œê°„
        val timeElapsedMs = stopWatch.totalTimeMillis // elapsed time

        // ë©”ì„œë“œ ì •ë³´ì™€ ìˆ˜í–‰ ì‹œê°„ ì¶œë ¥
        logger.info(
            "{} - {} | Arguments: {} | Execution Time: {}ms",
            className,
            methodName,
            methodArguments.joinToString(", "),
            timeElapsedMs
        )

        return result
    }
}
```
</div></details>
<details>
    <summary><b>QueryDSLì„ ì‚¬ìš©í•œ ê²€ìƒ‰ ê¸°ëŠ¥</b></summary>
    <br/>
    1. ë‹¤ì–‘í•œ ì¡°ê±´ì„ ë™ì  ì¿¼ë¦¬ë¡œ ì²˜ë¦¬<br/>
    <li>ì œëª© ë° ì‘ì„±ì: ê²€ìƒ‰ì–´ í¬í•¨</li>
    <li>ê²Œì‹œê¸€ ìƒíƒœ(Todo ì™„ë£Œ ì—¬ë¶€): ê²€ìƒ‰ê³¼ ì¼ì¹˜</li>
    <li>Nì¼ ì „ ê²Œì‹œê¸€: ê²€ìƒ‰ê³¼ ì¼ì¹˜</li>
    <br/>
    2. Pageableì„ ì‚¬ìš©í•´ í˜ì´ì§• ë° ì •ë ¬ ê¸°ëŠ¥ êµ¬í˜„<br/><br/>

<div>

``` 
@Repository
class TodoRepositoryImpl(
    private val queryFactory: JPAQueryFactory
) : CustomTodoRepository {

    // QueryDSL ì‚¬ìš©ì„ ìœ„í•œ Qíƒ€ì… í´ë˜ìŠ¤ ê°ì²´
    private val todo = QTodo.todo

    override fun search(searchType: SearchType, keyword: String, pageable: Pageable): Page<Todo> {

        // ê²€ìƒ‰ì¡°ê±´(SearchType)ì— ë”°ë¼ whereì ˆì— ì¶”ê°€ë  ì¿¼ë¦¬
        val where = when (searchType) {
            SearchType.NONE -> null
            SearchType.TITLE -> todo.title.like("%$keyword%") // í‚¤ì›Œë“œ í¬í•¨
            SearchType.WRITER -> todo.writer.like("%$keyword%") // í‚¤ì›Œë“œ í¬í•¨
            SearchType.STATE -> todo.completed.eq(TodoCompleted.valueOf(keyword)) // ì •í™•íˆ ì¼ì¹˜(TRUE or FALSE)
            SearchType.DAYSAGO -> // í˜„ì¬ ë‚ ì§œ - ì‘ì„±ì¼ì = Nì¼ì „
                Expressions.currentTimestamp().dayOfMonth()
                    .subtract(todo.createdAt.dayOfMonth())
                    .eq(keyword.toInt())
        }

        // ë°ì´í„° ì „ì²´ ê°œìˆ˜
        val totalCount = queryFactory.select(todo.count())
            .from(todo)
            // Soft Delete ì²˜ë¦¬ëœ ë°ì´í„° ì œì™¸ + ê²€ìƒ‰ ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°
            .where(todo.isDeleted.isFalse.and(where)) 
            .fetchOne() ?: 0L

        val contents = queryFactory.selectFrom(todo)
            .where(todo.isDeleted.isFalse.and(where))
            // ì •ë ¬ ê¸°ì¤€ì— ë”°ë¼ ë°ì´í„°ë¥¼ ì •ë ¬
            .orderBy(*QueryDslUtil.getOrderSpecifier(todo, pageable.sort))
            .offset(pageable.offset) // ê°€ì ¸ì˜¬ ë°ì´í„°ì˜ ì‹œì‘ ë²ˆí˜¸
            .limit(pageable.pageSize.toLong()) // ê°€ì ¸ì˜¬ ë°ì´í„°ì˜ ê°œìˆ˜
            .fetch()

        return PageImpl(contents, pageable, totalCount)
    }
}
```

search ë©”ì„œë“œ ë‚´ orderByì—ì„œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ
```
class QueryDslUtil {

    companion object {
        fun getOrderSpecifier(qEntity: EntityPathBase<*>, sort: Sort): Array<OrderSpecifier<*>> {
            val orders = arrayListOf<OrderSpecifier<*>>()

            sort.forEach {
                orders.add(
                    OrderSpecifier(
                        // ì •ë ¬ ì¡°ê±´ì´ ì˜¤ë¦„ì°¨ìˆœì´ë©´ ASC, ì•„ë‹ˆë©´ DESC
                        if (it.isAscending) Order.ASC else Order.DESC,
                        
                        // ì •ë ¬ ê¸°ì¤€ ì»¬ëŸ¼ì˜ Path
                        PathBuilder(qEntity.type, qEntity.metadata)
                            .get(it.property) as Expression<out Comparable<*>> 
                    )
                )
            }

            return orders.toTypedArray()
        }
    }
}
```
</div>
</details>
<details>
    <summary><b>AWS S3ë¥¼ ì´ìš©í•´ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„</b></summary><div><br/>
1. ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ìœ„í•œ S3 Service í´ë˜ìŠ¤ ì¶”ê°€

```
@Service
class S3Service(
    private val s3Operations: S3Operations,
    @Value("\${spring.cloud.aws.s3.bucket}")
    private val bucket: String,
) {

    @Transactional
    fun upload(file: MultipartFile, key: String): String {
        // ì—…ë¡œë“œí•  ì´ë¯¸ì§€ í™•ì¥ì ëª©ë¡ ì •ì˜
        val imageTypes = listOf("jpg", "jpeg", "png", "gif", "bmp")

        // contentTypeì˜ í™•ì¥ì ë¶€ë¶„ë§Œ ì¶”ì¶œ(ì˜ˆ: image/png -> png)í•´ ë¯¸ë¦¬ ì •ì˜í•œ í™•ì¥ìì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
        if (!imageTypes.contains(file.contentType.toString().split("/")[1])) {
            throw IllegalArgumentException("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.") // ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš° ì˜ˆì™¸ ë°œìƒ
        }

        file.inputStream.use { it -> // use: ë¸”ë¡ ë‚´ ì½”ë“œ ì‹¤í–‰ í›„ ì˜ˆì™¸ ë°œìƒ ì—¬ë¶€ì— ê´€ê³„ì—†ì´ close
            return s3Operations.upload(
                // ë²„í‚·ëª…, key(ë²„í‚· ì—…ë¡œë“œ ì‹œ ì ìš©ë˜ëŠ” íŒŒì¼ëª…), ì—…ë¡œë“œí•  íŒŒì¼(InputStream), íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°(ObjectMetadata)
                bucket, key, it,
                ObjectMetadata.builder().contentType(file.contentType).build()
            ).url.toString() // ì—…ë¡œë“œëœ URLì„ ë°˜í™˜
        }
    }
}
```

<br/>
2. ì—…ë¡œë“œ ìš”ì²­ íŒŒì¼ì˜ í¬ê¸°ê°€ ì„¤ì •ëœ íŒŒì¼ í¬ê¸°ë¥¼ ì´ˆê³¼í•˜ëŠ” ê²½ìš°ì— ëŒ€í•´ 2ê°œì˜ ì˜ˆì™¸ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€

```
class CustomFileSizeLimitExceededException(
    message: String, actual: Long, permitted: Long
) :
    FileSizeLimitExceededException(message, actual, permitted) {

    override val message: String
        get() = "ì—…ë¡œë“œ ê°€ëŠ¥í•œ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ í¬ê¸°ëŠ” ${permittedSize / (1024 * 1024)}MB ì…ë‹ˆë‹¤."
}

class CustomSizeLimitExceededException(
    message: String, actual: Long, permitted: Long
) : SizeLimitExceededException(message, actual, permitted) {

    override val message: String
        get() = "ì—…ë¡œë“œ ê°€ëŠ¥í•œ ì´ë¯¸ì§€ì˜ ì „ì²´ í¬ê¸°ëŠ” ${permittedSize / (1024 * 1024)}MB ì…ë‹ˆë‹¤."
}
```

<br/>
3. ìœ„ ë‘ ê°œì˜ ì˜ˆì™¸ í´ë˜ìŠ¤ë¥¼ GlobalExceptionHandler í´ë˜ìŠ¤ì— ì¶”ê°€

```
@RestControllerAdvice
class GlobalExceptionHandler {

    // ...

    @ExceptionHandler(FileSizeLimitExceededException::class)
    fun handleFileSizeLimitExceededException(e: FileSizeLimitExceededException): ResponseEntity<ErrorResponse> {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST)
            .body(
                ErrorResponse(
                    e.message?.let {
                        CustomFileSizeLimitExceededException(
                            it, // message
                            e.actualSize, // ì‹¤ì œ íŒŒì¼ í¬ê¸°
                            e.permittedSize // ìµœëŒ€ í—ˆìš© íŒŒì¼ í¬ê¸°
                        ).message
                    }
                )
            )
    }

    @ExceptionHandler(SizeLimitExceededException::class)
    fun handleSizeLimitExceededException(e: SizeLimitExceededException): ResponseEntity<ErrorResponse> {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST)
            .body(
                ErrorResponse(
                    e.message?.let {
                        CustomSizeLimitExceededException(
                            it, // message
                            e.actualSize, // ì‹¤ì œ íŒŒì¼ í¬ê¸°
                            e.permittedSize // ìµœëŒ€ í—ˆìš© íŒŒì¼ í¬ê¸°
                        ).message
                    }
                )
            )
    }
}
```
</div>
</details>
- <b>í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±</b><br/>
    - TodoController<br/>
    - TodoService<br/>
    - TodoRepository<br/>
<br />
<b><a href="http://todolist-env-1.eba-bgajgr3g.ap-northeast-2.elasticbeanstalk.com/swagger-ui/index.html">AWS EC2ë¥¼ ì´ìš©í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬</a></b><br/>
ğŸ’¡íŒŒì¼ ì—…ë¡œë“œì˜ ê²½ìš° PostManìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í•´ì•¼ í•¨<br/>
<img src="https://github.com/hellou8363/todolist/assets/89592727/a14610af-c506-4da8-9813-ac3a52655fae"/>

